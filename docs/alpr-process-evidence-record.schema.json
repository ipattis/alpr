{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://alpr.schema.org/v0.1/process-evidence-record.schema.json",
  "title": "AI Learning Process Evidence Record",
  "description": "A portable, verifiable schema for capturing pedagogical process in AI-assisted learning interactions across platforms. Designed for evaluators across educational contexts.",
  "type": "object",
  "required": ["id", "schema_version", "learner", "metadata", "engagement_summary", "process_dimensions"],
  "properties": {
    "id": {
      "type": "string",
      "format": "uri",
      "description": "Unique identifier for this record (URI)"
    },
    "schema_version": {
      "type": "string",
      "const": "0.1.0",
      "description": "Version of the ALPR schema"
    },
    "learner": {
      "$ref": "#/$defs/LearnerProfile"
    },
    "metadata": {
      "$ref": "#/$defs/RecordMetadata"
    },
    "engagement_summary": {
      "$ref": "#/$defs/EngagementSummary"
    },
    "process_dimensions": {
      "$ref": "#/$defs/ProcessDimensions"
    },
    "learning_episodes": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/LearningEpisode"
      },
      "description": "Student-curated episodes highlighting meaningful learning moments"
    },
    "growth_trajectories": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/GrowthTrajectory"
      },
      "description": "Longitudinal progressions across skills or behaviours"
    },
    "student_reflection": {
      "$ref": "#/$defs/StudentReflection"
    },
    "verification": {
      "$ref": "#/$defs/VerificationBlock"
    }
  },

  "$defs": {

    "LearnerProfile": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Decentralised Identifier (DID) or platform-specific learner ID"
        },
        "name": {
          "type": "string",
          "description": "Display name (optional, for rendering)"
        },
        "institution": {
          "type": "string",
          "description": "Current educational institution"
        },
        "grade_level": {
          "type": "string",
          "description": "Current grade or year level"
        }
      }
    },

    "RecordMetadata": {
      "type": "object",
      "required": ["generated_at", "period_start", "period_end", "platforms"],
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "When this record was generated"
        },
        "period_start": {
          "type": "string",
          "format": "date",
          "description": "Start of the observation period"
        },
        "period_end": {
          "type": "string",
          "format": "date",
          "description": "End of the observation period"
        },
        "platforms": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["platform_id", "name"],
            "properties": {
              "platform_id": {
                "type": "string",
                "format": "uri",
                "description": "MCP server identifier for the platform"
              },
              "name": {
                "type": "string"
              },
              "platform_type": {
                "type": "string",
                "enum": [
                  "ai_tutor",
                  "general_llm",
                  "code_assistant",
                  "research_tool",
                  "writing_assistant",
                  "language_learning",
                  "stem_platform",
                  "other"
                ]
              },
              "sessions_count": {
                "type": "integer",
                "minimum": 0
              },
              "total_active_minutes": {
                "type": "integer",
                "minimum": 0
              }
            }
          },
          "description": "AI platforms contributing data to this record"
        },
        "total_sessions": {
          "type": "integer",
          "minimum": 0
        },
        "total_active_hours": {
          "type": "number",
          "minimum": 0
        },
        "xapi_statement_count": {
          "type": "integer",
          "description": "Number of underlying xAPI statements this record is derived from"
        }
      }
    },

    "EngagementSummary": {
      "type": "object",
      "description": "High-level engagement metrics across all platforms",
      "properties": {
        "sessions_per_week_avg": {
          "type": "number",
          "minimum": 0
        },
        "avg_session_duration_minutes": {
          "type": "number",
          "minimum": 0
        },
        "engagement_consistency": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "How regularly the student engages (1 = perfectly consistent)"
        },
        "domain_distribution": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "domain": { "type": "string" },
              "percentage": { "type": "number", "minimum": 0, "maximum": 1 }
            }
          },
          "description": "Breakdown of time by subject domain"
        },
        "cognitive_demand_distribution": {
          "type": "object",
          "properties": {
            "remember": { "type": "number", "minimum": 0, "maximum": 1 },
            "understand": { "type": "number", "minimum": 0, "maximum": 1 },
            "apply": { "type": "number", "minimum": 0, "maximum": 1 },
            "analyse": { "type": "number", "minimum": 0, "maximum": 1 },
            "evaluate": { "type": "number", "minimum": 0, "maximum": 1 },
            "create": { "type": "number", "minimum": 0, "maximum": 1 }
          },
          "description": "Distribution of interactions across Bloom's taxonomy levels"
        },
        "depth_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Composite: (time × cognitive_demand × autonomy) / sessions"
        }
      }
    },

    "ProcessDimensions": {
      "type": "object",
      "description": "Core behavioural dimensions derived from AI interaction patterns. Each maps to skills that evaluators value.",
      "properties": {

        "intellectual_autonomy": {
          "type": "object",
          "description": "Does the student think independently or outsource cognition to AI?",
          "properties": {
            "prompt_specificity_trend": {
              "type": "string",
              "enum": ["increasingly_specific", "stable", "increasingly_vague"]
            },
            "ai_output_acceptance_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Proportion of AI outputs accepted without modification (lower = more autonomous)"
            },
            "independent_reasoning_episodes": {
              "type": "integer",
              "minimum": 0
            },
            "challenge_frequency": {
              "type": "number",
              "minimum": 0,
              "description": "Average times per session the student pushes back on AI outputs"
            },
            "composite_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "percentile": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "Rank against cohort (optional, requires benchmarking data)"
            }
          }
        },

        "metacognitive_awareness": {
          "type": "object",
          "description": "Does the student reflect on and regulate their own learning?",
          "properties": {
            "self_assessment_accuracy": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "strategy_switching_count": {
              "type": "integer",
              "minimum": 0
            },
            "reflection_depth": {
              "type": "string",
              "enum": ["surface", "moderate", "deep"]
            },
            "help_seeking_appropriateness": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "composite_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "percentile": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          }
        },

        "productive_struggle": {
          "type": "object",
          "description": "Does the student persist through difficulty before seeking help?",
          "properties": {
            "average_attempts_before_help": {
              "type": "number",
              "minimum": 0
            },
            "time_in_struggle_zone_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "abandonment_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "scaffolding_preference": {
              "type": "string",
              "enum": ["hints_preferred", "examples_preferred", "full_solutions_preferred"]
            },
            "composite_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "percentile": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          }
        },

        "iterative_refinement": {
          "type": "object",
          "description": "Does the student revise and improve work through multiple passes?",
          "properties": {
            "average_revision_cycles": {
              "type": "number",
              "minimum": 0
            },
            "revision_depth_distribution": {
              "type": "object",
              "properties": {
                "surface": { "type": "number", "minimum": 0, "maximum": 1 },
                "structural": { "type": "number", "minimum": 0, "maximum": 1 },
                "conceptual": { "type": "number", "minimum": 0, "maximum": 1 }
              }
            },
            "self_initiated_revision_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "composite_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "percentile": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          }
        },

        "knowledge_transfer": {
          "type": "object",
          "description": "Does the student apply concepts across different contexts?",
          "properties": {
            "cross_domain_application_count": {
              "type": "integer",
              "minimum": 0
            },
            "decreasing_scaffolding_for_repeated_skills": {
              "type": "boolean"
            },
            "analogical_reasoning_instances": {
              "type": "integer",
              "minimum": 0
            },
            "composite_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "percentile": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          }
        },

        "ai_literacy": {
          "type": "object",
          "description": "How effectively and critically does the student use AI tools?",
          "properties": {
            "prompt_engineering_sophistication": {
              "type": "string",
              "enum": ["basic", "intermediate", "advanced"]
            },
            "output_verification_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "appropriate_tool_selection": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "limitation_awareness_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "composite_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "percentile": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },

    "LearningEpisode": {
      "type": "object",
      "required": ["episode_id", "title", "domain", "episode_type", "timeline", "outcome"],
      "properties": {
        "episode_id": {
          "type": "string",
          "format": "uri"
        },
        "title": {
          "type": "string",
          "description": "Student-authored title for this episode"
        },
        "domain": {
          "type": "string",
          "description": "Subject area (aligned to standard taxonomy)"
        },
        "episode_type": {
          "type": "string",
          "enum": [
            "breakthrough_moment",
            "productive_failure",
            "concept_mastery",
            "creative_synthesis",
            "perspective_shift",
            "debugging_journey",
            "research_deep_dive",
            "collaborative_construction"
          ]
        },
        "platforms_involved": {
          "type": "array",
          "items": { "type": "string" }
        },
        "timeline": {
          "type": "object",
          "required": ["start", "end"],
          "properties": {
            "start": { "type": "string", "format": "date-time" },
            "end": { "type": "string", "format": "date-time" },
            "total_active_minutes": { "type": "integer", "minimum": 0 },
            "sessions_count": { "type": "integer", "minimum": 1 }
          }
        },
        "interaction_summary": {
          "type": "object",
          "properties": {
            "total_turns": { "type": "integer", "minimum": 0 },
            "student_initiated_turns_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "key_pivot_points": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "turn_number": { "type": "integer" },
                  "description": { "type": "string", "maxLength": 280 },
                  "significance": { "type": "string", "maxLength": 280 }
                }
              }
            }
          }
        },
        "cognitive_arc": {
          "type": "object",
          "properties": {
            "entry_understanding": {
              "type": "string",
              "enum": ["none", "misconception", "partial", "surface", "emerging"]
            },
            "exit_understanding": {
              "type": "string",
              "enum": ["surface", "procedural", "conceptual", "transferable", "generative"]
            },
            "blooms_peak": {
              "type": "string",
              "enum": ["remember", "understand", "apply", "analyse", "evaluate", "create"]
            }
          }
        },
        "student_annotation": {
          "type": "string",
          "maxLength": 1000,
          "description": "Student's own reflection on why this episode matters"
        },
        "evidence_artifacts": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "uri"],
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "conversation_excerpt",
                  "work_sample",
                  "before_after_comparison",
                  "diagram",
                  "code_diff",
                  "assessment_result",
                  "peer_feedback"
                ]
              },
              "uri": { "type": "string", "format": "uri" },
              "description": { "type": "string", "maxLength": 500 }
            }
          }
        },
        "outcome": {
          "type": "object",
          "properties": {
            "competency_demonstrated": { "type": "string" },
            "framework_alignment": {
              "type": "object",
              "properties": {
                "framework": { "type": "string" },
                "level": { "type": "string" }
              }
            },
            "verified_by": {
              "type": "string",
              "enum": [
                "platform_assessment",
                "teacher_review",
                "peer_review",
                "self_assessed",
                "external_assessment"
              ]
            }
          }
        }
      }
    },

    "GrowthTrajectory": {
      "type": "object",
      "required": ["trajectory_id", "skill", "data_points"],
      "properties": {
        "trajectory_id": { "type": "string" },
        "skill": {
          "type": "string",
          "description": "Skill or competency being tracked"
        },
        "framework_alignment": {
          "type": "object",
          "properties": {
            "framework": { "type": "string" },
            "level_start": { "type": "string" },
            "level_current": { "type": "string" }
          }
        },
        "data_points": {
          "type": "array",
          "minItems": 2,
          "items": {
            "type": "object",
            "required": ["date", "proficiency_estimate"],
            "properties": {
              "date": { "type": "string", "format": "date" },
              "proficiency_estimate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "scaffolding_level_needed": {
                "type": "string",
                "enum": ["full", "high", "moderate", "minimal", "none"]
              },
              "evidence_episode_id": { "type": "string" },
              "platform": { "type": "string" }
            }
          }
        },
        "velocity": {
          "type": "object",
          "properties": {
            "overall_slope": {
              "type": "number",
              "description": "Rate of improvement (positive = improving)"
            },
            "acceleration": {
              "type": "number",
              "description": "Change in rate (positive = accelerating)"
            },
            "consistency": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "R-squared of the trend line"
            }
          }
        },
        "notable_patterns": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "StudentReflection": {
      "type": "object",
      "properties": {
        "learning_philosophy": {
          "type": "string",
          "maxLength": 3000,
          "description": "Student's statement on their approach to learning with AI (~500 words)"
        },
        "selected_highlights": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "episode_ref": { "type": "string" },
              "why_it_matters": { "type": "string", "maxLength": 500 }
            }
          }
        },
        "challenges_faced": {
          "type": "string",
          "maxLength": 2000,
          "description": "Honest account of struggles and how they were addressed"
        },
        "future_goals": {
          "type": "string",
          "maxLength": 1500,
          "description": "What the student wants to learn next and why"
        },
        "authored_at": {
          "type": "string",
          "format": "date-time"
        }
      }
    },

    "VerificationBlock": {
      "type": "object",
      "description": "Cryptographic and institutional verification metadata",
      "properties": {
        "issuer_signatures": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["platform_id", "signature_type"],
            "properties": {
              "platform_id": { "type": "string", "format": "uri" },
              "platform_name": { "type": "string" },
              "signature_type": {
                "type": "string",
                "enum": ["DataIntegrityProof", "JsonWebSignature2020"]
              },
              "signed_at": { "type": "string", "format": "date-time" },
              "verification_method": { "type": "string" },
              "proof_value": { "type": "string" }
            }
          },
          "description": "Each contributing platform signs its portion of the data"
        },
        "institutional_endorsements": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "endorser_id": { "type": "string" },
              "endorser_name": { "type": "string" },
              "endorser_type": {
                "type": "string",
                "enum": ["school", "teacher", "counsellor", "third_party_verifier"]
              },
              "endorsement_statement": { "type": "string" },
              "endorsed_at": { "type": "string", "format": "date-time" }
            }
          }
        },
        "integrity_checks": {
          "type": "object",
          "properties": {
            "timing_analysis_passed": {
              "type": "boolean",
              "description": "Interaction timing patterns consistent with genuine learning"
            },
            "cross_platform_consistency": {
              "type": "boolean",
              "description": "Behavioural patterns consistent across platforms"
            },
            "anomaly_flags": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Any detected anomalies (empty = clean)"
            }
          }
        }
      }
    }
  }
}
